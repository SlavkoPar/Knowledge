const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AssignedAnswers-DXfDlHX5.js","assets/index-C9Wj4eVr.js","assets/index-CykrPP6v.css","assets/Options-CYMhzxUI.js","assets/lib-BL9hWg-q.js","assets/AutoSuggestAnswers-BAT3CRBJ.js","assets/AutoSuggestAnswers-vl2QUoNQ.css","assets/AutoSuggestQuestions-C8RK94Wm.js","assets/AutoSuggestQuestions-DN6HBK-e.css"])))=>i.map(i=>d[i]);
import{A as s,d as xt,a as wt,b as ht,F as f,I as me,u as ve,c as ne,r as m,C as Se,e as fe,f as re,g as qe,h as Ct,Q as Ge,i as ce,j as Rt,k as he,l as Tt,m as St,n as e,B as W,_ as _t,o as Fe,R as ge,D as xe,p as ue,q as It,s as Nt,t as vt}from"./index-C9Wj4eVr.js";import{L as oe,F as ie,f as Be,a as Me,u as Ce,B as Re,b as Pe,c as Ue,d as $e,e as _e,g as j,S as je,h as Ie,s as jt,i as Ot,C as Ve,j as Ke,Q as ze,k as Oe,l as Qt,m as At,n as bt,o as Dt,p as kt,M as we}from"./Options-CYMhzxUI.js";import{f as Lt,a as qt}from"./lib-BL9hWg-q.js";import{A as Gt}from"./AutoSuggestQuestions-C8RK94Wm.js";const Ne={topId:"",parentId:"null",id:"generateId",categoryTitle:"",title:"",assignedAnswers:[],numOfAssignedAnswers:0,relatedFilters:[],numOfRelatedFilters:0,source:0,status:0,included:!1},Ye={topId:"null",parentId:"null",id:"define at BackEnd",kind:0,title:"",link:"",header:"",level:0,variations:[],hasSubCategories:!1,categoryRows:[],questionRows:[],numOfQuestions:0,hasMoreQuestions:!1,isExpanded:!1,doc1:""},Ft=(t,i)=>{console.log("------------------------------->"),console.log("------------------------------->",i.type),console.log("------------------------------->");const{categoryRow:g}=i.payload;if(i.type===s.SET_FROM_LOCAL_STORAGE){const{keyExpanded:y}=i.payload;return{...t,keyExpanded:y}}let o=g?!xt.includes(i.type):!1;const{topRows:d}=t,n=wt.includes(i.type)?{...t}:Bt(t,i);if(o&&g){let y;const{topId:x,id:C}=g;if(C===x)y=d.map(S=>S.id===x?new J(g).categoryRow:new J(S).categoryRow);else{const S=d.find(w=>w.id===x);J.idToSet=C,J.newCategoryRow=g;const r=new J(S).categoryRow;y=d.map(w=>w.id===x?r:new J(w).categoryRow),J.idToSet=""}n.topRows=y}if(ht.includes(i.type)){const{keyExpanded:y}=n,x={keyExpanded:y};localStorage.setItem("CATEGORIES_STATE",JSON.stringify(x))}return console.log("CategoryReducer newState",n),n},Bt=(t,i)=>{switch(i.type){case s.SET_TOP_ROWS_LOADING:return{...t,loadingCategories:!0,topRowsLoading:!0};case s.SET_TOP_ROWS:{const{topRows:o}=i.payload;return console.log("=> CategoriesReducer ActionTypes.SET_TOP_ROWS",t.topRows,o),{...t,topRows:o,topRowsLoading:!1,topRowsLoaded:!0,loadingCategories:!1}}case s.SET_ALL_CATEGORY_ROWS:{const{allCategoryRows:o}=i.payload;return{...t,allCategoryRows:o,allCategoryRowsLoaded:Date.now()}}case s.SET_NODE_EXPANDING_UP_THE_TREE:{const{fromChatBotDlg:o}=i.payload,{keyExpanded:d,activeCategory:n,activeQuestion:y}=t;return{...t,nodeOpening:!0,loadingCategories:!0,nodeOpened:!1,keyExpanded:o?null:{...d},activeCategory:o?null:n,activeQuestion:o?null:y}}case s.SET_NODE_EXPANDED_UP_THE_TREE:{const{category:o,formMode:d,catKey:n,questionId:y,question:x}=i.payload,{id:C}=n;return{...t,activeCategory:o,activeQuestion:x,selectedQuestionId:y,formMode:d,categoryId_questionId_done:`${C}_${y}`,nodeOpening:!1,nodeOpened:!0,loadingCategories:!1}}case s.SET_LOADING_CATEGORY:return{...t,loadingCategory:!0,categoryLoaded:!1};case s.FORCE_OPEN_NODE:const{keyExpanded:g}=i.payload;return{...t,topRows:t.topRows.filter(o=>o.parentId===null),keyExpanded:g,nodeOpened:!1,activeCategory:null,activeQuestion:null,selectedQuestionId:null};case s.SET_SUB_CATEGORIES:return{...t,loadingCategory:!1};case s.SET_ERROR:{const{error:o,whichRowId:d}=i.payload;return{...t,error:o,whichRowId:d,loadingCategories:!1,loadingQuestions:!1,loadingCategory:!1,categoryLoaded:!1,loadingQuestion:!1,questionLoaded:!1}}case s.ADD_SUB_CATEGORY:{const{categoryKey:o,level:d}=i.payload,{topId:n}=o,y={...Ye,topId:n,level:d,parentId:""};return{...t,activeCategory:y,formMode:f.AddingCategory}}case s.SET_CATEGORY:{const{categoryRow:o}=i.payload;return console.assert(me(o)),{...t,loadingCategory:!1,categoryLoaded:!0,activeCategory:o,activeQuestion:null,selectedQuestionId:null}}case s.SET_ROW_EXPANDING:return{...t,rowExpanding:!0,rowExpanded:!1,loadingCategories:!0};case s.SET_ROW_EXPANDED:{const{categoryRow:o}=i.payload,{topId:d,id:n}=o,{keyExpanded:y}=t,x=y?y.questionId:null;return{...t,loadingCategories:!1,keyExpanded:{topId:d,categoryId:n,questionId:x},activeQuestion:null,selectedQuestionId:x,loadingQuestion:!1,questionLoaded:!1,rowExpanding:!1,rowExpanded:!0}}case s.SET_ROW_COLLAPSED:{const{categoryRow:o}=i.payload,{topId:d,parentId:n}=o;return{...t,loadingCategories:!1,keyExpanded:{topId:d,categoryId:n??"",questionId:null},rowExpanding:!1,rowExpanded:!0,activeCategory:null,activeQuestion:null,selectedQuestionId:null}}case s.SET_CATEGORY_TO_VIEW:{const{categoryRow:o}=i.payload;console.assert(me(o));const n={...o,isExpanded:!1};return{...t,formMode:f.ViewingCategory,loadingCategory:!1,activeCategory:n,activeQuestion:null,selectedQuestionId:null}}case s.SET_CATEGORY_TO_ADD_TOP:{const{newCategoryRow:o}=i.payload;return{...t,loadingCategory:!1,categoryLoaded:!0,activeCategory:{...o,doc1:""},activeQuestion:null,selectedQuestionId:null,topRows:[o,...t.topRows],formMode:f.AddingCategory}}case s.SET_CATEGORY_TO_ADD:{const{newCategoryRow:o}=i.payload;return{...t,loadingCategory:!1,categoryLoaded:!0,activeCategory:{...o,doc1:""},activeQuestion:null,selectedQuestionId:null,formMode:f.AddingCategory}}case s.SET_CATEGORY_ADDED:{const{categoryRow:o}=i.payload;console.assert(me(o));const n={...o,isExpanded:!1},{topId:y,id:x}=n;return{...t,formMode:f.EditingCategory,loadingCategory:!1,categoryLoaded:!1,activeCategory:n,activeQuestion:null,selectedQuestionId:null,keyExpanded:{topId:y,categoryId:x,questionId:null},nodeOpened:!1}}case s.SET_CATEGORY_TO_EDIT:case s.SET_CATEGORY_UPDATED:{const{categoryRow:o,category:d}=i.payload;console.assert(me(o));const{topId:n,id:y}=d;return{...t,formMode:f.EditingCategory,loadingCategory:!1,categoryLoaded:!0,keyExpanded:{topId:n,categoryId:y,questionId:null},activeCategory:d,activeQuestion:null,selectedQuestionId:null}}case s.SET_CATEGORY_QUESTIONS_LOADING:return{...t,loadingQuestions:!0,questionLoaded:!1};case s.CATEGORY_QUESTIONS_LOADED:return{...t,loadingQuestions:!1};case s.DELETE_CATEGORY:return{...t,activeCategory:null,formMode:f.None,error:void 0,whichRowId:void 0};case s.CANCEL_CATEGORY_FORM:case s.CLOSE_CATEGORY_FORM:return{...t,activeCategory:null,formMode:f.None};case s.CANCEL_ADD_SUB_CATEGORY:return{...t,activeCategory:null,activeQuestion:null,selectedQuestionId:null,formMode:f.None};case s.SET_LOADING_QUESTION:return{...t,loadingQuestion:!0,questionLoaded:!1};case s.CANCEL_ADD_QUESTION:return{...t,formMode:f.None,activeQuestion:null,selectedQuestionId:null};case s.SET_QUESTION_SELECTED:{const{questionKey:o}=i.payload,{topId:d,parentId:n,id:y}=o;return{...t,topRows:t.topRows.filter(x=>x.parentId===null),keyExpanded:{topId:d,categoryId:n,questionId:y},nodeOpened:!1,activeCategory:null,activeQuestion:null,selectedQuestionId:null}}case s.ADD_NEW_QUESTION_TO_ROW:{const{newQuestionRow:o}=i.payload;return{...t,selectedQuestionId:o.id}}case s.SET_QUESTION:{const{question:o,formMode:d}=i.payload;return console.log(s.SET_QUESTION,o),{...t,activeCategory:null,activeQuestion:o,formMode:d,error:void 0,loadingCategory:!1,loadingQuestion:!1,questionLoaded:!0}}case s.SET_QUESTION_AFTER_ASSIGN_ANSWER:{const{question:o}=i.payload;return{...t,activeQuestion:o,loadingQuestion:!1,questionLoaded:!0}}case s.SET_QUESTION_TO_VIEW:{const{question:o}=i.payload,{keyExpanded:d}=t;return{...t,formMode:f.ViewingQuestion,keyExpanded:d,activeQuestion:o,loadingQuestion:!1,questionLoaded:!0}}case s.SET_QUESTION_TO_EDIT:{const{question:o}=i.payload,{topId:d,id:n,parentId:y}=o;return{...t,keyExpanded:{topId:d,categoryId:y,questionId:n},activeQuestion:o,formMode:f.EditingQuestion,selectedQuestionId:o.id,loadingQuestion:!1,questionLoaded:!0}}case s.QUESTION_DELETED:return{...t,activeQuestion:null,selectedQuestionId:null,formMode:f.None,loadingQuestion:!1,questionLoaded:!0};case s.CANCEL_QUESTION_FORM:case s.CLOSE_QUESTION_FORM:return{...t,formMode:f.None,activeQuestion:null,selectedQuestionId:null};default:return alert(`Action ${i.type} not allowed`),{...t}}};class J{static idToSet;static newCategoryRow;constructor(i){const{topId:g,id:o,parentId:d,title:n,link:y,kind:x,header:C,level:S,variations:r,numOfQuestions:w,hasSubCategories:O,categoryRows:N,created:Q,modified:P,questionRows:A,isExpanded:V}=i,R=N.map(b=>(console.log("DeepClone >>>>>>>>>>>>>>>",b.id),b.id===J.idToSet?{...J.newCategoryRow}:new J(b).categoryRow));this.categoryRow={topId:g,parentId:d,id:o,kind:x,title:n,link:y,header:C,level:S,hasSubCategories:O,categoryRows:R,numOfQuestions:w,questionRows:A,variations:r??[],created:Q,modified:P,isExpanded:V}}categoryRow}const We=m.createContext({}),He=m.createContext(()=>null),Mt={formMode:f.None,allCategoryRows:new Map,allCategoryRowsLoaded:void 0,topRows:[],topRowsLoading:!1,topRowsLoaded:!1,nodeOpening:!1,nodeOpened:!1,keyExpanded:null,categoryId_questionId_done:void 0,activeCategory:null,activeQuestion:null,selectedQuestionId:null,loadingCategories:!1,loadingQuestions:!1,loadingCategory:!1,categoryLoaded:!1,loadingQuestion:!1,questionLoaded:!1,error:void 0,rowExpanding:!1,rowExpanded:!1},Pt=({children:t})=>{const{loadAllCategoryRowsGlobal:i}=ve(),g=ne(),{KnowledgeAPI:o,isAuthenticated:d,workspace:n,authUser:y,canEdit:x}=g,{nickName:C}=y,[S,r]=m.useReducer(Ft,Mt),{formMode:w,activeCategory:O,activeQuestion:N,keyExpanded:Q,topRows:P,allCategoryRows:A,allCategoryRowsLoaded:V}=S;console.log("----->>> ----->>> ----->>> CategoryProvider"),m.useEffect(()=>{let l=n==="SLINDZA"?{topId:"QUESTIONS",categoryId:"QUESTIONS",questionId:"qqqqqq111"}:{topId:"MTS",categoryId:"REMOTECTRLS",questionId:"qqqqqq111"};if("localStorage"in window){let a=localStorage.getItem("CATEGORIES_STATE");if(console.log("CATEGORIES_STATE loaded before signIn",a),a!==null){const p=JSON.parse(a);p.keyExpanded!==null&&(l=p.keyExpanded)}}r({type:s.SET_FROM_LOCAL_STORAGE,payload:{keyExpanded:l}})},[n]);const R=m.useCallback(async(l,a,p=null,c=void 0)=>{const u=localStorage.getItem("accessToken");if(u)try{console.log("------Execute endpoint:",a);let E=null;const h=new Headers,_=`Bearer ${u}`;h.append("Authorization",_),p&&h.append("Content-Type","application/json");let k={method:l,headers:h,body:p?JSON.stringify(p):null};if(E=await fetch(a,k),E.ok){if(E.status===200||E.status===201){let U=null;try{U=await E.json()}catch{r({type:s.SET_ERROR,payload:{error:new Error(`Response status: ${E.status}`),whichRowId:c}})}finally{return U}}}else{const{errors:U}=await E.json(),H=new Error(U?.map(ee=>ee.message).join(`
`)??"unknown");r({type:s.SET_ERROR,payload:{error:H,whichRowId:c}})}}catch(E){console.log("-------------->>> execute",l,a,E),r({type:s.SET_ERROR,payload:{error:new Error("fetch eror"),whichRowId:c}})}return null},[]),b=m.useCallback(async()=>new Promise(async l=>{const a=await i();r(a?{type:s.SET_ALL_CATEGORY_ROWS,payload:{allCategoryRows:a}}:{type:s.SET_ERROR,payload:{error:new Error("Zajeb allCategoryRows")}}),l(a)}),[i]),$=m.useCallback(async l=>{try{return A.get(l)}catch(a){console.log(a),r({type:s.SET_ERROR,payload:{error:a}})}},[A]);m.useEffect(()=>{(async()=>V===void 0&&await b())()},[V,b]);const I=m.useCallback(async l=>{try{let a="";const p=[];return A.forEach((c,u)=>{u===l?a="":c.parentId===l&&p.push(c)}),{subCats:p,parentHeader:a}}catch(a){return console.log(a),r({type:s.SET_ERROR,payload:{error:a}}),{subCats:[],parentHeader:"Kiks subCats"}}},[A]),G=m.useCallback(async()=>new Promise(async l=>{try{r({type:s.SET_TOP_ROWS_LOADING,payload:{}});const a=`${o.endpointCategoryRow}/${n}/null/topRows/all`;console.log("CategoryProvider loadTopRows url:",a),console.log("loadTopRows AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"),console.time(),await R("GET",a).then(p=>{console.timeEnd(),console.log("loadTopRows BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB");const c=p.map(u=>(u.IsExpanded=Q?u.Id===Q.categoryId:!1,new Se(u).categoryRow));r({type:s.SET_TOP_ROWS,payload:{topRows:c}}),l(!0)})}catch(a){console.log(a),r({type:s.SET_ERROR,payload:{error:a}})}}),[R,o.endpointCategoryRow,Q,n]),L=m.useCallback(async(l,a)=>{const{topId:p,id:c}=l;return console.log({categoryKey:l,includeQuestionId:a}),new Promise(async u=>{try{const E=`${o.endpointCategory}/${n}/${p}/${c}/${ye}/${a}`;console.time(),console.log("================ getCategory ======================="),await R("GET",E).then(h=>{console.timeEnd();const{categoryDto:_,msg:k}=h;u(_?new fe(_).category:new Error(k))})}catch(E){console.log(E),u(E)}})},[R,o.endpointCategory,n]),q=m.useCallback((l,a)=>{if(l.topId===a)return l;const{categoryRows:p}=l;let c=p.find(u=>u.id===(a??"null"));if(!c)try{p.forEach(u=>{if(console.log(a,u.id),c=q(u,a),c)throw new Error("Stop the loop")})}catch{}return c},[]),D=m.useCallback(async(l,a,p="false")=>new Promise(async()=>{try{let{topId:c,parentId:u,id:E}=l;if(console.assert(E!==null,"id ne sme biti null u expandNodesUpToTheTree"),E){const U=A.get(E);U?(l.topId=U.topId,l.parentId=U.parentId):alert("reload all categoryRow:"+E)}r({type:s.SET_NODE_EXPANDING_UP_THE_TREE,payload:{fromChatBotDlg:p==="true"}}),console.time();const h={topId:c,id:E,parentId:null},_=new re(h).toQuery(n),k=`${o.endpointCategoryRow}?${_}&pageSize=${ye}&includeQuestionId=${a??null}`;await R("GET",k).then(async U=>{const{categoryRowDto:H}=U;if(console.timeEnd(),H){let ee=null,de=null,ae=new Se(H).categoryRow;if(u!==null){const Ee=q(ae,E);if(ee={...Ee,doc1:""},a){const ke=Ee.questionRows.find(Le=>Le.id===a&&Le.included);ke&&(ee=null,de={...ke,assignedAnswers:[],numOfAssignedAnswers:0,numOfRelatedFilters:0,relatedFilters:[],source:0,status:0})}}console.log(">>> expandNodeUpToTheTree categoryRow",{categoryRow:ae,questionId:"'"+(a??"jok")+"'"+(a??"JOK")});const Te=a?x?f.EditingQuestion:f.ViewingQuestion:x?f.EditingCategory:f.ViewingCategory;r({type:s.SET_NODE_EXPANDED_UP_THE_TREE,payload:{catKey:l,categoryRow:ae,category:ee,questionId:a??null,question:de,formMode:Te,fromChatBotDlg:p==="true"}})}})}catch(c){console.log(c),r({type:s.SET_ERROR,payload:{error:c}})}}),[n,o.endpointCategoryRow,R,A,q,x]),M=m.useCallback(async(l,a=!1,p=null)=>{const c=new re(l).toQuery(n);return new Promise(async u=>{try{const E=`${o.endpointCategoryRow}/${a}/${ye}/${p}?${c}`;console.time(),await R("GET",E).then(h=>{console.timeEnd();const{categoryRowDto:_,msg:k}=h;u(_?new Se(_).categoryRow:new Error(k))})}catch(E){console.log(E),u(E)}})},[R,o.endpointCategoryRow,n]),F=m.useCallback(async({categoryKey:l,includeQuestionId:a,newQuestionRow:p,formMode:c})=>{try{r({type:s.SET_ROW_EXPANDING,payload:{}});const u=await M(l,!0,a);if(u instanceof Error)r({type:s.SET_ERROR,payload:{error:u}}),console.error({cat:u});else{let E;return a&&u.questionRows.filter(h=>h.included).length>0&&(E=a),p&&(u.questionRows=[p,...u.questionRows]),u.isExpanded=!0,console.log("@@@@@@@@@@@@@@@@@ expandCategory:",c,a),c===f.None&&a&&(c=x?f.EditingQuestion:f.ViewingQuestion),r({type:s.SET_ROW_EXPANDED,payload:{categoryRow:u,formMode:c,selectedQuestionId:E}}),u}}catch(u){return console.log("error",u),r({type:s.SET_ERROR,payload:{error:u}}),null}},[x,M]),Z=m.useCallback(async l=>{const{topId:a,id:p}=l,c=P.find(E=>E.id===a);l={...c.id===p?c:q(c,p),isExpanded:!1,categoryRows:[],questionRows:[]},r({type:s.SET_ROW_COLLAPSED,payload:{categoryRow:l}})},[q,P]),T=m.useCallback(async l=>{try{r({type:s.CLOSE_CATEGORY_FORM,payload:{}});const{topId:a,id:p,parentId:c,level:u}=l??{topId:"generateId",id:"generateId",parentId:null,level:0},E={...Ye,topId:a,parentId:l?p:c,id:"generateId",level:u+1,title:"",isExpanded:!1};if(l===null)r({type:s.SET_CATEGORY_TO_ADD_TOP,payload:{newCategoryRow:E}});else{const h={...l,level:u+1,categoryRows:[E,...l.categoryRows],hasSubCategories:!0,isExpanded:!0};r({type:s.SET_CATEGORY_TO_ADD,payload:{categoryRow:h,newCategoryRow:E}})}}catch(a){console.log("error",a),r({type:s.SET_ERROR,payload:{error:a}})}},[]),z=m.useCallback(async()=>{try{const{topId:l,id:a,parentId:p}=O,u={categoryKey:{topId:l,parentId:p,id:a},formMode:f.None},E=await F(u);E&&r({type:s.CANCEL_ADD_SUB_CATEGORY,payload:{categoryRow:E}})}catch(l){console.log("error",l),r({type:s.SET_ERROR,payload:{error:l}})}},[O,F]),se=m.useCallback(async l=>{const{id:a}=l;r({type:s.SET_LOADING_CATEGORY,payload:{}});try{const p=new qe(l,n).categoryDto;console.log("categoryDto",{categoryDto:p});const c=`${o.endpointCategory}`;console.time(),await R("POST",c,p,a).then(async u=>{console.timeEnd();const{categoryDto:E}=u;if(E){const h=new fe(E).category;console.log("Category successfully created",{category:h}),await b().then(async()=>{await G(),h.parentId===null?r({type:s.SET_CATEGORY_ADDED,payload:{categoryRow:h}}):r({type:s.SET_CATEGORY_ADDED,payload:{categoryRow:h}})})}})}catch(p){console.log(p),r({type:s.SET_ERROR,payload:{error:new Error("Server Error"),whichRowId:a}})}},[R,o.endpointCategory,b,G,n]),v=m.useCallback(async()=>{try{const{topId:l,parentId:a}=N,c={categoryKey:{topId:l,parentId:a,id:a},formMode:f.None},u=await F(c);u&&r({type:s.CANCEL_ADD_QUESTION,payload:{categoryRow:u}})}catch(l){console.log("error",l),r({type:s.SET_ERROR,payload:{error:l}})}},[N,F]),B=m.useCallback(async(l,a)=>{w===f.AddingQuestion?await v():w===f.AddingCategory&&await z(),r({type:s.SET_LOADING_CATEGORY,payload:{categoryRow:l}});const p=new re(l).categoryKey,c=await L(p,a);c instanceof Error?r({type:s.SET_ERROR,payload:{error:c}}):(c.topId=l.topId,r({type:s.SET_CATEGORY_TO_VIEW,payload:{categoryRow:c}}))},[z,v,w,L]),Y=m.useCallback(async(l,a)=>{w===f.AddingQuestion?await v():w===f.AddingCategory&&await z(),r({type:s.SET_LOADING_CATEGORY,payload:{}});const p=new re(l).categoryKey,c=await L(p,a);if(c instanceof Error)r({type:s.SET_ERROR,payload:{error:c}});else{const u={...c,isExpanded:!1,categoryRows:[],questionRows:[]};r({type:s.SET_CATEGORY_TO_EDIT,payload:{categoryRow:u,category:c}})}},[z,v,w,L]),X=m.useCallback(async l=>{r({type:s.SET_LOADING_CATEGORY,payload:{}});try{const a=new qe(l,n).categoryDto,p=`${o.endpointCategory}`;console.time(),await R("PUT",p,a).then(c=>{console.timeEnd();const{categoryDto:u,msg:E}=c;if(u){const h=new fe(u).category,{topId:_}=h;h.isExpanded=!1,h.topId=_,r({type:s.SET_CATEGORY_UPDATED,payload:{category:h}})}else r({type:s.SET_ERROR,payload:{error:new Error(`${E}`)}})})}catch(a){return console.log(a),r({type:s.SET_ERROR,payload:{error:new Error("Karambol")}}),a}},[R,o.endpointCategory,n]),le=m.useCallback(async l=>{try{const{topId:a,parentId:p}=l,c=new Ct(l,n).categoryRowDto,u=`${o.endpointCategory}`;console.time(),await R("DELETE",u,c).then(async E=>{console.timeEnd();const{categoryDto:h,msg:_}=E;_==="OK"?(console.log("Category successfully deleted",{categoryRow:l}),await b().then(async()=>{const k={categoryKey:{topId:a,parentId:"",id:p},formMode:f.None};p?await G():await F(k).then(()=>{})})):r(_==="HasSubCategories"?{type:s.SET_ERROR,payload:{error:new Error("First remove sub categories"),whichRowId:h.Id}}:_==="HasQuestions"?{type:s.SET_ERROR,payload:{error:new Error("First remove category questions"),whichRowId:h.Id}}:{type:s.SET_ERROR,payload:{error:new Error(_),whichRowId:h.Id}})})}catch(a){return console.log(a),a}},[R,o.endpointCategory,F,b,G,n]),rt=async(l,a)=>{try{console.log("Deleting Category Tag...",{categoryKey:l,variationName:a}),console.log("Category Tag successfully deleted")}catch(p){console.log("error",p),r({type:s.SET_ERROR,payload:{error:p}})}},ye=12,it=m.useCallback(async({categoryKey:l,startCursor:a,includeQuestionId:p})=>{try{const{topId:c,id:u}=l;r({type:s.SET_CATEGORY_QUESTIONS_LOADING,payload:{}});try{const E=`${o.endpointQuestion}/${n}/${c}/${u}/${a}/${ye}/${p}`;console.time(),await R("GET",E).then(h=>{console.timeEnd();const{categoryDto:_}=h;if(_!==null){const k=new fe(_).category;r({type:s.CATEGORY_QUESTIONS_LOADED,payload:{categoryRow:k}})}})}catch(E){console.log(E),r({type:s.SET_ERROR,payload:{error:E}})}}catch(c){console.log(c),r({type:s.SET_ERROR,payload:c})}},[R,o.endpointQuestion,n]),lt=m.useCallback(async(l,a)=>{try{const{topId:p,id:c}=l;let u=await $(c);if(!u){alert(`Not found ${c}. Reload all Categories`);return}const E={topId:p,parentId:l.id,id:"generateId",title:"question text",categoryTitle:u.title,numOfAssignedAnswers:0,included:!0},h={...Ne,...E,title:""};if(console.assert(a),a){const _=S.topRows.find(U=>U.id===p),k=q(_,c);k.questionRows=[E,...k.questionRows],r({type:s.ADD_NEW_QUESTION_TO_ROW,payload:{categoryRow:k,newQuestionRow:E}}),r({type:s.SET_QUESTION,payload:{question:h,formMode:f.AddingQuestion}})}}catch(p){console.log("error",p),r({type:s.SET_ERROR,payload:{error:p}})}},[F,q,$,S.topRows]),dt=m.useCallback(async l=>{const{topId:a,id:p,parentId:c}=l;r({type:s.SET_LOADING_CATEGORY,payload:{}});try{l.created.nickName=C;const u=new Ge(l,n).questionDto,E=`${o.endpointQuestion}`;console.time(),console.log(">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> createQuestion",u),await R("POST",E,u).then(async h=>{if(console.timeEnd(),h){console.log("::::::::::::::::::::",{questionDtoEx:h});const{questionDto:_}=h;if(_){const k=new ce(_).question;k.topId=a,console.log("Question successfully created"),await b().then(async()=>{const H={categoryKey:{topId:a,parentId:c,id:c},formMode:f.EditingQuestion};await F(H).then(()=>{r({type:s.SET_QUESTION,payload:{formMode:f.EditingQuestion,question:k}})})})}}})}catch(u){console.log(u),r({type:s.SET_ERROR,payload:{error:new Error("Server Error"),whichRowId:p}})}},[R,o.endpointQuestion,F,b,C,n]),ct=m.useCallback(async(l,a,p)=>{const{id:c}=a;try{a.modified.nickName=C;const u=new Ge(a,n).questionDto,E=`${o.endpointQuestion}`;console.time(),u.oldParentId=l,console.log(">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> updateQuestion",u);let h=null;return await R("PUT",E,u).then(async _=>{console.timeEnd();const{questionDto:k,msg:U}=_;if(k){h=new ce(k).question,console.log("Question successfully updated: ",h);const{topId:H,parentId:ee}=h;if(p){const{topId:de,parentId:ae,id:Te}=h,Ee={topId:de,categoryId:ae,questionId:Te};r({type:s.FORCE_OPEN_NODE,payload:{keyExpanded:Ee}})}else{const ae={categoryKey:{topId:H,parentId:ee,id:ee},formMode:f.EditingQuestion};await F(ae).then(()=>{r({type:s.SET_QUESTION,payload:{formMode:f.EditingQuestion,question:h}})})}}else r({type:s.SET_ERROR,payload:{error:new Error(U)}})}),h}catch(u){console.log(u),r({type:s.SET_ERROR,payload:{error:new Error("Server Error"),whichRowId:c}})}},[R,o.endpointQuestion,F,C,n]),ut=m.useCallback(async(l,a)=>{const{id:p,parentId:c,topId:u}=l;r({type:s.SET_LOADING_QUESTION,payload:{}});try{const E=new Rt(l,n).questionRowDto,h=`${o.endpointQuestion}`;console.time(),await R("DELETE",h,E).then(async _=>{const{questionDto:k}=_;if(console.timeEnd(),k){const U=new ce(k).question;console.log("Question successfully deleted"),a&&r({type:s.QUESTION_DELETED,payload:{question:U}});const ee={categoryKey:{topId:u,parentId:c,id:c},formMode:f.None};await F(ee).then(()=>{})}else console.error(_),r({type:s.SET_ERROR,payload:{error:new Error("Server Error"),whichRowId:p}})})}catch(E){console.log(E),r({type:s.SET_ERROR,payload:{error:new Error("Server Error"),whichRowId:p}})}},[R,o.endpointQuestion,F,n]),pe=m.useCallback(async l=>new Promise(async a=>{try{const p=new he(l).toQuery(n),c=`${o.endpointQuestion}?${p}`;console.time(),console.log("getQuestion",l),await R("GET",c).then(u=>{console.timeEnd();const{questionDto:E,msg:h}=u;if(E){const _={question:new ce(E).question,msg:h};a(_)}else a({question:null,msg:h})})}catch(p){console.log(p),a({question:null,msg:"Problemos"})}}),[R,o.endpointQuestion,n]),gt=m.useCallback(async l=>{const a=new he(l).questionKey;r({type:s.SET_LOADING_QUESTION,payload:{}});const p=await pe(a);w===f.AddingQuestion?await v():w===f.AddingCategory&&await z();const{question:c,msg:u}=p;c?(c.topId=l.topId,r({type:s.SET_QUESTION_TO_VIEW,payload:{question:c}})):r({type:s.SET_ERROR,payload:{error:new Error(u)}})},[z,v,w,pe]),yt=m.useCallback(async l=>{const a=new he(l).questionKey;w===f.AddingQuestion?await v():w===f.AddingCategory&&await z(),r({type:s.SET_LOADING_QUESTION,payload:{}}),console.log("editQuestion:",a);const p=await pe(a),{question:c,msg:u}=p;c?(c.topId=l.topId,r({type:s.CLOSE_QUESTION_FORM,payload:{question:c}}),r({type:s.SET_QUESTION_TO_EDIT,payload:{question:c}})):r({type:s.SET_ERROR,payload:{error:new Error(u)}})},[z,v,w,pe]),pt=m.useCallback(async(l,a,p)=>{try{var{topId:c,id:u}=p,E={topId:c,id:u,created:{time:new Date,nickName:C}};const h=new Tt(E).assignedAnswerDto;h.QuestionKeyDto=new St(a,n).dto;let _=null;const k=`${o.endpointQuestionAnswer}/${l}`;console.time(),await R("POST",k,h).then(async U=>{console.timeEnd();const{questionDto:H}=U;console.log("::::::::::::::::::::",{questionDtoEx:U}),H&&(_=new ce(H).question,console.log("Question successfully modified"))}),_&&r({type:s.SET_QUESTION_AFTER_ASSIGN_ANSWER,payload:{question:_}})}catch(h){console.log("error",h),r({type:s.SET_ERROR,payload:{error:h}})}},[R,o.endpointQuestionAnswer,C,n]),Et=m.useCallback((l,a)=>{console.log("Provider onCategoryTitleChanged:",a),r({type:s.CATEGORY_TITLE_CHANGED,payload:{categoryRow:{...l,title:a}}})},[]),mt=m.useCallback((l,a,p)=>{const{parentId:c,id:u}=a,E=q(l,c);if(E){const h=E.questionRows.find(_=>_.id===u);h.title=p,console.log("onQuestionTitleChanged+++>>>",u,E),r({type:s.QUESTION_TITLE_CHANGED,payload:{categoryRow:E}})}},[q]),ft={state:S,loadAllCategoryRows:b,getSubCats:I,getCat:$,expandNodesUpToTheTree:D,loadTopRows:G,addSubCategory:T,cancelAddCategory:z,createCategory:se,viewCategory:B,editCategory:Y,updateCategory:X,deleteCategory:le,deleteCategoryVariation:rt,expandCategory:F,collapseCategory:Z,onCategoryTitleChanged:Et,loadCategoryQuestions:it,addQuestion:lt,cancelAddQuestion:v,createQuestion:dt,viewQuestion:gt,editQuestion:yt,updateQuestion:ct,deleteQuestion:ut,onQuestionTitleChanged:mt,assignQuestionAnswer:pt};return!d||!V||Q===null?null:e.jsx(We.Provider,{value:ft,children:e.jsx(He.Provider,{value:r,children:t})})};function K(){return m.useContext(We)}const Qe=()=>m.useContext(He);var te=(t=>(t.SET_LOADING="SET_LOADING",t.SET_SUB_CATS="SET_SUB_CATS",t.SET_ERROR="SET_ERROR",t.SET_EXPANDED="SET_EXPANDED",t.SET_PARENT_CAT="SET_PARENT_CAT",t))(te||{});const Ut=({cat:t,dispatch:i,setParentCat:g,selId:o})=>{const{topId:d,parentId:n,id:y,title:x,level:C,isExpanded:S}=t,r={topId:d,parentId:n,id:y},w=Q=>{i({type:te.SET_EXPANDED,payload:{id:y,expanding:!S}})},O=Q=>{g(Q)},N=e.jsxs("div",{className:"d-flex justify-content-start align-items-center w-100 text-primary",children:[e.jsx(W,{variant:"link",size:"sm",className:"py-0 px-1",onClick:Q=>{w(),Q.stopPropagation(),Q.preventDefault()},title:"Expand",children:e.jsx(ie,{icon:S?Be:Me,size:"lg"})}),e.jsx(W,{variant:"link",size:"sm",className:"py-0 mx-0 text-decoration-none",title:y,onClick:()=>O(t),children:x})]});return e.jsxs(e.Fragment,{children:[e.jsx(oe.Item,{variant:"primary",className:"py-0 px-1 w-100",as:"li",children:N}),S&&e.jsx(oe.Item,{className:"py-0 px-0",variant:"primary",as:"li",children:e.jsx(Je,{selId:o,level:C+1,categoryKey:r,setParentId:g})})]})},$t={loading:!1,parentId:null,title:"",cats:[]},Vt=(t,i)=>{switch(i.type){case te.SET_LOADING:return{...t,loading:!0};case te.SET_SUB_CATS:{const{subCats:g}=i.payload;return{...t,cats:t.cats.concat(g),loading:!1}}case te.SET_ERROR:{const{error:g}=i.payload;return{...t,error:g,loading:!1}}case te.SET_EXPANDED:{const{id:g,expanding:o}=i.payload;let{cats:d}=t;if(!o){const n=Xe(d,g);console.log("clean:",n),n.length>0&&(d=d.filter(y=>!n.includes(y.id)))}return{...t,cats:t.cats.map(n=>n.id===g?{...n,isExpanded:o}:n)}}case te.SET_PARENT_CAT:{const{cat:g}=i.payload,{id:o,title:d}=g;return{...t,parentId:o,title:d}}default:return t}};function Xe(t,i){let g=t.filter(o=>o.parentId===i).map(o=>o.id);return g.forEach(o=>{const d=o?Xe(t,o):[];g=g.concat(d)}),g}const Je=({selId:t,categoryKey:i,level:g,setParentId:o})=>{const[d,n]=m.useReducer(Vt,$t),{getSubCats:y}=K(),{id:x}=i??{id:null},[C]=m.useState(i);m.useEffect(()=>{(async()=>{const w=await y(x),{subCats:O}=w;n({type:te.SET_SUB_CATS,payload:{subCats:O}})})()},[y,C,x]);const S=d.cats.filter(w=>w.parentId===x),r=w=>{n({type:te.SET_PARENT_CAT,payload:{cat:w}}),o(w)};return e.jsxs("div",{className:g>1?"border  border-7 ms-4 h-25":"border border-7  h-25",style:{overflowY:"auto"},children:[e.jsx(oe,{as:"ul",variant:"dark",className:"mb-0",children:S.filter(w=>w.id!==t).map(w=>e.jsx(Ut,{cat:w,selId:t,dispatch:n,setParentCat:r},w.id))}),d.error&&d.error.message]})},Kt=({relatedFilter:t})=>{const{filter:i,numOfUsages:g,created:o,lastUsed:d}=t,{time:n,nickName:y}=o,x=`Created by: ${y}, ${Lt(new Date(n))}`,C=!1,S=N=>{console.log("RelatedFilter onSelectAnswer",{filter:N})},[r,w]=Ce(),O=e.jsxs("div",{ref:r,className:"d-flex justify-content-start align-items-center w-100 text-light related-filter-row",children:[e.jsx(W,{variant:"link",size:"sm",className:"py-0 mx-0 title text-light text-wrap",title:x,onClick:()=>S(i),disabled:C,children:i}),e.jsxs(Re,{pill:!0,bg:"secondary",className:`text-light ${g===0?"d-none":"d-inline"}`,children:[g,g===1?" usage":" usages"]}),e.jsx("span",{className:"small ms-1",children:qt(d.time)}),w]});return e.jsx(oe.Item,{className:"py-0 px-0",as:"li",children:O},i)},zt=({relatedFilters:t})=>{const{globalState:i}=ve(),{variant:g}=i,{state:o}=K(),d=async n=>{console.log("RelatedFilters unAssignFilter",{relatedFilter:n})};return e.jsx("div",{className:"mx-0 my-1 border rounded-2 px-1 py-1border-light fs-6 related-filters",children:e.jsxs("div",{children:[e.jsx("label",{className:"text-muted",children:"Most frequently selected Filters (for the next Question in ChatBot)"}),t.length>0?e.jsx(oe,{as:"ul",variant:g,className:"my-1",children:t.map(n=>e.jsx(Kt,{relatedFilter:n,unAssignFilter:d},n.filter))}):e.jsx("div",{className:"border text-light",children:"No filters"}),o.error&&e.jsx("div",{children:"state.error"})]})})},Ae=({question:t,submitForm:i,children:g,showCloseButton:o,source:d=0,closeModal:n})=>{const{state:y,onQuestionTitleChanged:x}=K();let{formMode:C,topRows:S}=y;const r=m.lazy(()=>_t(()=>import("./AssignedAnswers-DXfDlHX5.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8])).then(v=>({default:v.default}))),w=C===f.ViewingQuestion,O=C===f.EditingQuestion,N=C===f.AddingQuestion,Q=w,{topId:P,id:A,assignedAnswers:V,relatedFilters:R,title:b}=t,$=new he(t).questionKey,I=Qe(),G=()=>{n?n():I({type:s.CLOSE_QUESTION_FORM,payload:{question:t}})},L=()=>{n?n():I({type:s.CANCEL_QUESTION_FORM,payload:{question:t}})},[q,D]=m.useState(A+"/"+b),M=Pe(q,500),[F]=m.useState(S.find(v=>v.id===P)),Z=m.useRef(null),T=Ue({enableReinitialize:!0,initialValues:t,validationSchema:$e().shape({title:_e().required("Required"),parentId:_e().required("Required").notOneOf(["000000000000000000000000"])}),onSubmit:v=>{i(v),D(v.id+"/"+v.title)}});m.useEffect(()=>{(async()=>{const B=M.split("/"),Y=B[0];if(T.values.id===Y){console.log("QuestionForm.useEffect - onQuestioTitleChanged",{debouncedSearchTerm:M,searchTerm:q,title:T.values.title});const X=B[1];await x(F,T.values,X)}})()},[M,T.values,x,q,F]),m.useEffect(()=>{Z.current.focus(),d!==0&&T.setFieldValue("source",d)},[T,Z,d]);const z=v=>{T.handleChange(v);const B=v.target.value;D(A+"/"+B)},se=v=>{T.setFieldValue("parentId",v.id),T.setFieldValue("categoryTitle",v.title)};return console.log("@@@@@@@@@@@@@@@@@@@@@ QuestionForm.render: ",{searchTerm:q,qTitle:b,debouncedSearchTerm:M}),e.jsxs("div",{className:"form-wrapper px-3 py-1 my-0 my-1 w-100 question-form",children:[o&&e.jsx(Fe,{onClick:G,className:"float-end"}),e.jsx(ge,{className:"text-center",children:e.jsxs(j.Label,{children:["Question  ",w?"Viewing":O?"Editing":"Adding"]})}),e.jsxs(j,{onSubmit:T.handleSubmit,children:[e.jsxs(je,{direction:"horizontal",gap:0,className:"border",children:[e.jsx("div",{className:"p-0",children:e.jsx(j.Label,{children:"Category:"})}),e.jsx("div",{className:"p-1",children:e.jsxs(j.Group,{controlId:"parentId",className:"category-select form-select-sm w-90",children:[e.jsxs(xe,{children:[e.jsx(xe.Toggle,{variant:"light",id:"dropdown-basic",className:"px-2 py-0 text-primary border",disabled:Q,children:e.jsx("span",{className:"text-wrap me-1",children:T.values.categoryTitle})}),e.jsx(xe.Menu,{className:"p-0 border",children:e.jsx(xe.Item,{className:"p-0 m-0 rounded-3",children:e.jsx(Je,{selId:T.values.parentId,categoryKey:null,level:1,setParentId:se})})})]}),e.jsx(j.Control,{as:"input",name:"parentId",onChange:T.handleChange,value:T.values.parentId?T.values.parentId:"",placeholder:"Category",className:"text-primary w-100",disabled:Q,hidden:!0}),e.jsx(j.Text,{className:"text-danger",children:T.touched.parentId&&T.errors.parentId?e.jsx("div",{className:"text-danger",children:T.errors.parentId?"required":""}):null})]})})]}),e.jsxs(j.Group,{controlId:"title",children:[e.jsx(j.Label,{children:"Title"}),e.jsx(j.Control,{as:"textarea",name:"title",placeholder:T.values.title==="new Question"?"new Question":"question text",ref:Z,onChange:z,value:T.values.title,rows:3,className:"text-primary w-100",disabled:Q}),e.jsx(j.Text,{className:"text-danger",children:T.touched.title&&T.errors.title?e.jsx("div",{className:"text-danger",children:T.errors.title}):null})]}),e.jsxs(ge,{children:[e.jsx(ue,{children:e.jsxs(j.Group,{controlId:"source",children:[e.jsx(j.Label,{children:"Source"}),e.jsx(Ie,{id:"source",name:"source",options:jt,onChange:(v,B)=>{v.preventDefault(),T.setFieldValue("source",B)},value:T.values.source,disabled:Q,classes:"text-primary"}),e.jsx(j.Text,{className:"text-danger",children:T.touched.source&&T.errors.source?e.jsx("div",{className:"text-danger",children:T.errors.source}):null})]})}),e.jsx(ue,{children:e.jsxs(j.Group,{controlId:"status",children:[e.jsx(j.Label,{children:"Status"}),e.jsx(Ie,{id:"status",name:"status",options:Ot,onChange:(v,B)=>{v.preventDefault(),T.setFieldValue("status",B)},value:T.values.status,disabled:Q,classes:"text-primary"}),e.jsx(j.Text,{className:"text-danger",children:T.touched.status&&T.errors.status?e.jsx("div",{className:"text-danger",children:T.errors.status}):null})]})})]}),(w||O)&&e.jsxs("div",{className:"my-1",children:[e.jsx(m.Suspense,{fallback:e.jsx("div",{children:"Loading..."}),children:e.jsx(r,{questionKey:$,questionTitle:q,assignedAnswers:V,isDisabled:Q})}),e.jsx(zt,{questionKey:$,questionTitle:q,relatedFilters:R}),e.jsx(Ve,{created:t.created,modified:t.modified,classes:"text-primary"})]}),(T.dirty&&O||N)&&e.jsx(Ke,{cancelForm:L,handleSubmit:T.handleSubmit,title:g}),y.error&&e.jsx("div",{className:"text-danger",children:y.error.message})]})]})},be=({closeModal:t,showCloseButton:i,source:g,setError:o})=>{const{state:d,cancelAddQuestion:n,createQuestion:y}=K(),{activeQuestion:x}=d,C=x?x.topId:"",S=async()=>{await n()},r=async w=>{const O={...w,topId:C,created:{time:new Date,nickName:""},modified:void 0},N=await y(O,t!==void 0);N&&(N.message?o(N.message):t&&t())};return x?e.jsx(Ae,{question:x,showCloseButton:i??!0,source:g??0,closeModal:S,submitForm:r,children:"Create Question"}):null},Ze=({})=>{const{state:t,updateQuestion:i}=K(),{activeQuestion:g}=t;if(!g)return null;if(!g)return e.jsx("div",{children:"Loading question to edit..."});const o=async d=>{const n={...d,created:void 0,modified:{time:new Date,nickName:""}},{parentId:y}=g,x=y!==n.parentId;await i(y,n,x)};return e.jsx(Ae,{question:g,showCloseButton:!0,source:0,submitForm:o,children:"Update Question"})},et=({inLine:t})=>{console.log(t?"ViewQuestion inLine":"ViewQuestion not inLine");const{state:i}=K(),{activeQuestion:g}=i,[o,d]=m.useState(null);return m.useEffect(()=>{console.log("#################################### ViewQuestion setQuestion ...",{activeQuestion:g}),d(g)},[g]),e.jsx(Ae,{question:o,showCloseButton:!0,source:0,submitForm:()=>{},children:"View Question"})},Yt=({questionRow:t,isSelected:i})=>{const{id:g,topId:o,parentId:d,title:n,numOfAssignedAnswers:y}=t,x={topId:o,parentId:d,id:d},{canEdit:C,authUser:S}=ne(),{state:r,viewQuestion:w,addQuestion:O,editQuestion:N,deleteQuestion:Q}=K(),{activeQuestion:P,formMode:A,loadingQuestion:V,questionLoaded:R}=r,b=P!==null&&P.id===g,$=A===f.AddingQuestion,I=()=>{t.modified={time:new Date,nickName:S.nickName},Q(t,b)},G=async M=>{console.log("QuestionRow onSelectQuestion",{id:M}),C?await N(t):await w(t)},[L,q]=Ce();m.useEffect(()=>{(async()=>{if(i&&!V&&!R){switch(A){case f.ViewingQuestion:await w(t);break;case f.EditingQuestion:console.log("Zovem from QuestionRow"),C?await N(t):await w(t);break}document.getElementById(`QuestionRow${g}`)?.scrollIntoView({behavior:"smooth",block:"end"})}})()},[C,N,A,g,i,V,R,t,w]);const D=e.jsxs("div",{id:`QuestionRow${g}`,className:`d-relative d-flex justify-content-start align-items-center w-100 mt-1 question-row${i?"-selected":""}`,style:{marginTop:"1px"},children:[e.jsx(W,{variant:"link",size:"sm",className:"d-flex align-items-center px-1 text-secondary",children:e.jsx("img",{width:"22",height:"18",src:It,alt:"Question"})}),e.jsx(W,{variant:"link",size:"sm",className:`p-0 px-1 m-1 ms-0 question-row-title ${b?"fw-bold":""}`,title:`id:${g.toString()}`,onClick:()=>G(g),disabled:$,children:n}),e.jsxs(Re,{pill:!0,bg:"secondary",className:`text-info ${y===0?"d-none":"d-inline"}`,children:[y,"a"]}),C&&!$&&q&&e.jsxs("div",{className:"position-absolute text-nowrap d-flex align-items-center border border-0 border-warning p-0 end-0",children:[e.jsx(W,{variant:"link",size:"sm",className:"ms-1 p-0 text-secondary d-flex align-items-center",title:"Add Question",onClick:()=>{O(x,!0)},children:e.jsx("img",{width:"22",height:"18",src:ze,alt:"Add Question"})}),e.jsx(W,{variant:"link",size:"sm",className:"ms-0 p-0 text-secondary",onClick:I,children:e.jsx(ie,{icon:Oe,size:"lg"})})]})]});return e.jsxs(oe.Item,{className:"py-0 px-0 w-100",as:"li",children:[i&&A===f.AddingQuestion&&e.jsxs(e.Fragment,{children:[e.jsx("div",{id:"div-question",className:"ms-0 d-md-none w-100",children:e.jsx(be,{showCloseButton:!0,source:0})}),e.jsx("div",{ref:L,className:"d-none d-md-block  border rounded-3",children:D})]}),i&&A===f.EditingQuestion&&e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:L,className:"",children:D}),e.jsx("div",{id:"div-question",className:"ms-0 d-md-none w-100",children:e.jsx(Ze,{inLine:!0})})]}),i&&A===f.ViewingQuestion&&e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:L,className:"",children:D}),e.jsx("div",{ref:L,id:"div-question",className:"ms-0 d-md-none w-100",children:e.jsx(et,{inLine:!0})})]}),!i&&e.jsx("div",{ref:L,className:"",children:D})]})},tt=({categoryRow:t})=>{const{state:i,loadCategoryQuestions:g}=K(),{keyExpanded:o,loadingQuestion:d,error:n,selectedQuestionId:y}=i,{questionId:x}=o;t.level+=1;const{questionRows:C}=t;let S=!1;async function r(){try{const N={categoryKey:new re(t).categoryKey,startCursor:C.length,includeQuestionId:x??null};console.log("^^^^^^^^^^^^^ loadMore"),console.log("^^^^^^^^^^^^^",{x:N}),console.log("^^^^^^^^^^^^^ loadMore"),await g(N)}catch{}finally{}}const[w,{rootRef:O}]=Qt({loading:d,hasNextPage:S,onLoadMore:r,disabled:!!n,rootMargin:"0px 0px 100px 0px"});return e.jsxs("div",{ref:O,className:"ms-0",style:{maxHeight:"400px",overflowY:"auto"},children:[e.jsxs(At,{children:[C.length===0&&e.jsx("label",{children:"No questions"}),C.map(N=>e.jsx(Yt,{questionRow:N,isSelected:N.id===y},N.id)),S]}),n&&e.jsxs("p",{children:["Error: ",n.message]})]})},Wt=({categoryKey:t,tag:i,categoryInAdding:g})=>{const{name:o}=i,{canEdit:d}=ne(),{state:n,deleteCategoryVariation:y}=K(),x=()=>{y(t,o)},[C,S]=Ce(),r=e.jsxs("div",{ref:C,children:[e.jsx(Re,{pill:!0,bg:"secondary",children:o}),d&&!0&&S&&e.jsx(W,{variant:"link",size:"sm",className:"ms-0 py-0 mx-0 text-secondary",onClick:x,children:e.jsx(ie,{icon:Oe,size:"sm"})}),!1]});return e.jsx("div",{className:"py-1 px-1",children:r})},Ht=({categoryKey:t,variations:i})=>{const{state:g}=K(),{error:o}=g;return m.useEffect(()=>{},[]),e.jsxs("div",{className:"ms-2",children:[e.jsxs(je,{direction:"horizontal",gap:2,children:[i.length===0&&e.jsx("div",{children:"No variations"}),i.length>0&&i.map(d=>e.jsx(Wt,{categoryKey:t,tag:d,categoryInAdding:void 0}))]}),o&&e.jsxs("p",{children:["Error: ",o.message]})]})},De=({formMode:t,category:i,submitForm:g,children:o})=>{const{onCategoryTitleChanged:d}=K(),n=t===f.ViewingCategory,y=t===f.EditingCategory,x=t===f.AddingCategory,{topId:C,id:S,variations:r,questionRows:w,title:O}=i;console.log("CategoryForm render: ",{topId:C,id:S,catTitle:O,formMode:t});const N=new re(i).categoryKey;document.getElementById("div-details");const Q=w&&w.length>0,P=Qe(),A=()=>{P({type:s.CLOSE_CATEGORY_FORM,payload:{}})},V=()=>{P({type:s.CANCEL_CATEGORY_FORM,payload:{}})},[R,b]=m.useState(O),$=Pe(R,300),I=Ue({enableReinitialize:!0,initialValues:i,validationSchema:$e().shape({title:_e().required("Required")}),onSubmit:D=>{console.log("CategoryForm.onSubmit",JSON.stringify(D,null,2)),g(D),b(D.title)}});m.useEffect(()=>{(async()=>{console.log("CategoryForm.useEffect - onCategoryTitleChanged",{debouncedSearchTerm:$,title:I.values.title}),await d(I.values,$)})()},[$,I.values,d]);const G=D=>{I.handleChange(D);const M=D.target.value;b(M)},L=m.useRef(null);m.useEffect(()=>{L.current.focus()},[i.title,L]);const q=!1;return console.log("CategoryForm render return: ",R),e.jsxs("div",{className:"form-wrapper p-2 category-form",children:[e.jsx(Fe,{onClick:A,className:"float-end"}),e.jsx(ge,{className:"text-center text-muted",children:e.jsxs(j.Label,{children:["Category ",n?"Viewing":y?"Editing":"Adding"]})}),e.jsxs(j,{onSubmit:()=>I.handleSubmit,children:[e.jsx(j.Group,{controlId:"Variations",children:e.jsxs(je,{direction:"horizontal",gap:1,children:[e.jsx("div",{className:"px-0",children:e.jsx(j.Label,{children:"Variations:"})}),e.jsx("div",{className:"px-1 border border-1 border-secondary rounded",children:e.jsx(Ht,{categoryKey:N,variations:r?r.map(D=>({name:D})):[]})}),e.jsx("div",{className:"ps-2",children:e.jsx(j.Label,{children:"Kind:"})}),e.jsx("div",{className:"px-1 border border-1 border-secondary rounded",children:e.jsxs(j.Group,{controlId:"kind",children:[e.jsx(Ie,{id:"kind",name:"kind",options:bt,onChange:(D,M)=>{D.preventDefault(),I.setFieldValue("kind",M)},value:I.values.kind,disabled:q,classes:"text-primary"}),e.jsx(j.Text,{className:"text-danger",children:I.touched.kind&&I.errors.kind?e.jsx("div",{className:"text-danger",children:I.errors.kind}):null})]})})]})}),e.jsxs(j.Group,{controlId:"title",children:[e.jsx(j.Label,{children:"Title"}),e.jsx(j.Control,{as:"textarea",name:"title",placeholder:I.values.title==="new Category"?"new Category":"category text",value:R,onChange:G,ref:L,rows:3,className:"text-primary w-100",disabled:n}),e.jsx(j.Text,{className:"text-danger",children:I.touched.title&&I.errors.title?e.jsx("div",{className:"text-danger",children:I.errors.title}):null})]}),e.jsxs(j.Group,{controlId:"link",children:[e.jsx(j.Label,{children:"Link"}),I.values.hasSubCategories?e.jsx(j.Control,{as:"input",placeholder:"/categories/...",name:"link",onChange:I.handleChange,className:"text-primary w-100",value:"Can't have link (has sub categories)",disabled:!0}):e.jsxs(e.Fragment,{children:[e.jsx(j.Control,{as:"input",placeholder:"/categories/...",name:"link",onChange:I.handleChange,className:"text-primary w-100",value:I.values.link??"",disabled:n}),e.jsx(j.Text,{className:"text-danger",children:I.touched.link&&I.errors.link?e.jsx("div",{className:"text-danger",children:I.errors.link}):null})]})]}),e.jsxs(j.Group,{children:[e.jsxs(j.Label,{className:"m-1 mb-0",children:["Questions (",`${I.values.numOfQuestions}`,") "]}),Q&&e.jsx(tt,{categoryRow:i})]}),(n||y)&&e.jsx(Ve,{created:i.created,modified:i.modified,classes:"text-primary"}),(I.dirty&&y||x)&&e.jsx(Ke,{cancelForm:V,handleSubmit:I.handleSubmit,title:o})]})]})},ot=({inLine:t})=>{const i=ne(),{nickName:g}=i.authUser,{state:o,updateCategory:d}=K(),{activeCategory:n,keyExpanded:y}=o,{questionId:x}=y,C=async S=>{const r={...S,created:void 0,modified:{time:new Date,nickName:g}};await d(r,!0)};return e.jsx(De,{inLine:t,category:{...n},questionId:x,formMode:f.EditingCategory,submitForm:C,children:"Update Category"})},st=({inLine:t})=>{const{state:i}=K(),{activeCategory:g,keyExpanded:o}=i,{questionId:d}=o;return e.jsx(De,{inLine:t,category:{...g},questionId:d,formMode:f.ViewingCategory,submitForm:()=>{},children:"View Category"})},nt=({activeCategory:t})=>{const i=ne(),{nickName:g}=i.authUser,{createCategory:o}=K(),[d]=m.useState({...t}),n=async y=>{const x={...y,created:{time:new Date,nickName:g},modified:void 0};console.log("**********object",x),await o(x)};return!t===null?null:(console.log("AddCategory render >>>>>:",t),e.jsx(e.Fragment,{children:e.jsx(De,{inLine:!1,category:d,questionId:null,formMode:f.AddingCategory,submitForm:n,children:"Create Category"})}))},Xt=({categoryRow:t,questionId:i})=>{const{id:g,title:o,hasSubCategories:d,numOfQuestions:n,isExpanded:y}=t;t.level+=1;const x=new re(t).categoryKey,{canEdit:C,authUser:S}=ne(),{state:r,addSubCategory:w,viewCategory:O,editCategory:N,deleteCategory:Q,expandCategory:P,collapseCategory:A,addQuestion:V}=K();let{formMode:R,activeCategory:b,loadingCategory:$,categoryLoaded:I}=r;const G=b!==null&&b.id===g,L=R===f.AddingCategory,q=y&&n>0,D=()=>{t.modified={time:new Date,nickName:S.nickName},Q(t)},M=async()=>{if(y)await A(t);else{const X={categoryKey:x,byClick:!0,formMode:C?f.EditingCategory:f.ViewingCategory};await P(X)}},F=async()=>{C?await N(t,i??"null"):await O(t,i??"null")},[Z,T]=m.useState(!1);m.useEffect(()=>{Z&&(w(t),T(!1))},[w,t,Z]);const[z,se]=m.useState(!1);m.useEffect(()=>{z&&(V(x,y??!1),se(!1))},[V,x,y,z]),m.useEffect(()=>{(async()=>{if(G&&!$&&!I&&!L)switch(console.log("CategoryRow formMode:",R),R){case f.ViewingCategory:await O(t,i??"null");break;case f.EditingCategory:C?await N(t,i??"null"):await O(t,i??"null");break}})()},[C,x,I,t,N,P,R,L,G,$,i,O]);const[v,B]=Ce(),Y=e.jsxs("div",{children:[e.jsxs("div",{id:`Row${g}`,className:`d-relative d-flex justify-content-start align-items-center w-100 mt-1 category-row${G?"-selected":""}`,style:{marginTop:"1px"},children:[e.jsx(W,{variant:"link",size:"sm",className:"py-0 px-1",onClick:X=>{M(),X.stopPropagation()},title:"Expand",disabled:L||!d&&n===0,children:e.jsx(ie,{icon:y?Be:Me,size:"lg"})}),e.jsx(W,{variant:"link",size:"sm",className:"py-0 px-1 bg-light",title:"Expand",disabled:!0,children:e.jsx(ie,{icon:Dt,size:"sm"})}),e.jsx(W,{variant:"link",size:"sm",className:`py-0 ms-0 me-1 category-row-title ${G?"fw-bold text-white bg-transparent":""}`,title:g,onClick:F,disabled:L,children:o}),n>0&&e.jsxs(Re,{pill:!0,bg:"secondary",className:"d-inline bg-transparent",children:[n,"Q"]}),C&&B&&e.jsxs("div",{className:"position-absolute text-nowrap d-flex align-items-center border border-0 border-warning p-0 end-0",children:[e.jsx("div",{className:"d-flex align-items-center",children:e.jsx(W,{variant:"link",size:"sm",className:"border-0 py-0 px-0 ms-0 text-success",title:"Add SubCategory",onClick:async()=>{!y&&(d||n>0)&&await M(),setTimeout(()=>T(!0),500)},children:e.jsx(ie,{icon:kt,size:"lg"})})}),!L&&!d&&e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(W,{variant:"link",size:"sm",className:"p-0 mx-0 text-secondary d-flex align-items-center border border-0 border-warning1",title:"Add Question",onClick:async()=>{!y&&(d||n>0)&&await M(),setTimeout(()=>se(!0),500)},children:e.jsx("img",{width:"22",height:"18",src:ze,alt:"Add Question"})}),e.jsx(W,{variant:"link",size:"sm",className:"d-flex align-items-center border border-0 border-warning p-0",disabled:d||n>0,onClick:D,children:e.jsx(ie,{icon:Oe,size:"lg"})})]})]})]}),q&&e.jsx("div",{className:"ps-3",children:e.jsx(tt,{categoryRow:t})})]});return e.jsxs(e.Fragment,{children:[e.jsxs(oe.Item,{className:"py-0 px-1 w-100 category-bg",as:"li",children:[G&&R===f.AddingCategory&&e.jsxs("div",{children:[e.jsx("div",{ref:v,className:"",children:Y}),e.jsx("div",{className:"ms-0 d-md-none w-100",children:e.jsx(nt,{activeCategory:b})})]}),G&&R===f.EditingCategory&&e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:v,className:"",children:Y}),e.jsx("div",{id:"divInLine",className:"ms-0 d-md-none w-100",children:e.jsx(ot,{inLine:!1})})]}),G&&R===f.ViewingCategory&&e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:v,className:"",children:Y}),e.jsx("div",{id:"divInLine",className:"ms-0 d-md-none w-100",children:e.jsx(st,{inLine:!1})})]}),!G&&e.jsx("div",{ref:v,className:"",children:Y})]}),r.error&&r.whichRowId===g&&e.jsx("div",{className:"text-danger",children:r.error.message}),y&&e.jsx(oe.Item,{className:"py-0 px-0 border-0 border-warning border-bottom-0 category-bg",variant:"primary",as:"li",children:y&&e.jsx(e.Fragment,{children:d&&e.jsx(at,{categoryRow:t,title:o,isExpanded:y})})})]})},at=({categoryRow:t,title:i})=>{const{state:g}=K();let{keyExpanded:o}=g;const{questionId:d}=o??{questionId:null};let n=1,y=[];return i==="ROOT"?y=g.topRows:(y=t.categoryRows,n=t.level),e.jsx("div",{className:n>1?"ms-2":"",children:e.jsx(oe,{as:"ul",variant:"dark",className:"mb-0 category-bg",children:y.map(x=>e.jsx(Xt,{categoryRow:x,questionId:d},x.id))})})},Jt=t=>{const{isDarkMode:i}=ne(),[g,o]=m.useState("");return m.useEffect(()=>{},[]),e.jsxs(we,{show:t.show,onHide:t.onHide,animation:!0,centered:!0,size:"lg",className:"modal show",contentClassName:`${i?"bg-secondary bg-gradient":"bg-info bg-gradient"}`,children:[e.jsx(we.Header,{closeButton:!0,children:"Store new Question to the Database"}),e.jsx(we.Body,{className:"py-0",children:e.jsx(be,{closeModal:t.onHide,showCloseButton:!1,source:1,setError:d=>o(d)})}),e.jsx(we.Footer,{children:g})]})},Zt=({categoryId_questionId:t,fromChatBotDlg:i})=>{const{state:g,expandNodesUpToTheTree:o,loadTopRows:d,addSubCategory:n}=K(),{allCategoryRows:y,topRows:x,topRowsLoading:C,topRowsLoaded:S,keyExpanded:r,categoryId_questionId_done:w,nodeOpening:O,nodeOpened:N,activeCategory:Q,activeQuestion:P,formMode:A,loadingCategories:V,loadingCategory:R,loadingQuestions:b,loadingQuestion:$}=g,{searchQuestions:I,setLastRouteVisited:G,setChatBotDlgEnabled:L}=ve(),{isDarkMode:q,chatBotDlgEnabled:D}=ne(),[M,F]=m.useState(!1),[Z,T]=m.useState({...Ne}),z=Qe(),se=async B=>{z({type:s.SET_QUESTION_SELECTED,payload:{questionKey:B}})};let v="";return m.useEffect(()=>{(async()=>!C&&!S&&(console.log("ZOVEM 111 loadTopRows()"),await d()))()},[C,S,d]),m.useEffect(()=>{(async()=>{if(!O&&x.length>0){if(t){if(t==="add_question"){const B=localStorage.getItem("New_Question");if(B){const Y=JSON.parse(B);return T({...Ne,categoryTitle:"Select",...Y}),F(!0),localStorage.removeItem("New_Question"),null}}else if(t!==w){const B=t.split("_"),Y=B[0],X=B[1],le={topId:"",id:Y,parentId:"ROOT"};console.log("zovem expandNodesUpToTheTree 1111111111111111111)",{categoryId_questionId:t},{categoryId_questionId_done:w}),await o(le,X,i??"false").then(()=>null)}}else if(r&&!N){const{topId:B,categoryId:Y,questionId:X}=r;if(Y!==""){const le={topId:B,id:Y,parentId:"ROOT"};console.log("zovem expandNodeUpToTheTree 2222222222222)",{keyExpanded:r,catKey:le}),await o(le,X).then(()=>null)}}D||L()}})()},[r,O,N,o,t,w,x,i,D]),m.useEffect(()=>{G("/categories")},[G]),t!=="add_question"&&t&&t!==w?(console.log("zzzzzz loading...",{keyExpanded:r,categoryId_questionId:t,categoryId_questionId_done:w}),e.jsx("div",{children:"loading..."})):!S||x.length===0?(console.log("===>>> Categories  VRATIO"),null):(console.log("===>>> Categories !!!!!!!!!!!!!!!!!",Q),e.jsxs(e.Fragment,{children:[e.jsxs(vt,{children:[e.jsxs("h5",{className:"text-warning mx-auto w-75 fw-bold",children:[e.jsx("span",{className:"categories",children:"Categories / "}),e.jsx("span",{className:"questions",children:"Questions"})]}),e.jsx(ge,{className:`${q?"dark":""}`,children:e.jsx(ue,{children:e.jsx("div",{className:"d-flex justify-content-start align-items-center",children:e.jsx("div",{className:"w-75 my-1 questions",children:e.jsx(Gt,{tekst:v,onSelectQuestion:se,allCategoryRows:y,searchQuestions:I})})})})}),e.jsx(W,{variant:"secondary",size:"sm",type:"button",style:{padding:"1px 4px"},onClick:()=>n(null),children:"Add Category"}),e.jsxs(ge,{className:"my-1 h-auto",children:[e.jsx(ue,{xs:12,md:5,children:e.jsx("div",{className:"categories-border",style:{position:"relative"},children:e.jsx(at,{categoryRow:null,title:"ROOT",isExpanded:!0})})}),e.jsx(ue,{xs:0,md:7,children:e.jsxs("div",{id:"div-details",className:"d-none d-md-block",children:[Q&&A===f.ViewingCategory&&e.jsx(st,{inLine:!1}),Q&&A===f.EditingCategory&&e.jsx(ot,{inLine:!1}),Q&&A===f.AddingCategory&&e.jsx(nt,{activeCategory:Q}),P&&A===f.ViewingQuestion&&e.jsx(et,{inLine:!1}),P&&A===f.EditingQuestion&&e.jsx(Ze,{inLine:!1}),P&&A===f.AddingQuestion&&e.jsx(be,{})]})})]})]}),M&&P&&e.jsx(Jt,{show:M,onHide:()=>{F(!1)},newQuestionRow:Z}),(V||b)&&e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{position:"absolute",top:"40%",left:"20%"},children:e.jsx("div",{className:`spinner-border ${b?"question":"category"}-spinner`,role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})}),R&&e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{position:"absolute",top:"50%",left:"50%"},children:e.jsx("div",{className:"spinner-border category-spinner",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})}),$&&e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{position:"absolute",top:"50%",left:"50%"},children:e.jsx("div",{className:"spinner-border question-spinner",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})})]}))},eo=()=>{let{categoryId_questionId:t,fromChatBotDlg:i}=Nt();if(t&&t==="categories"&&(t=void 0),t){const g=t.split("_");console.assert(g.length===2,"expected 'categoryId_questionId'")}return e.jsx(Pt,{children:e.jsx(Zt,{categoryId_questionId:t,fromChatBotDlg:i})})},ao=Object.freeze(Object.defineProperty({__proto__:null,default:eo},Symbol.toStringTag,{value:"Module"}));export{ao as C,K as u};
//# sourceMappingURL=Categories-BmDuzjc3.js.map
