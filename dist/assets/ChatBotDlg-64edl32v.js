import{r as o,S as p,m as e,T as y,a9 as J,u as X,aq as Y,ar as ve,as as ke,s as Be,n as Te,at as A,t as Re,R as V,p as W,B as R,au as Ie,q as Ee,j as I}from"./index-DQX-hdgO.js";import{A as Qe}from"./AutoSuggestQuestions-BH6rO1NF.js";import"./lib-D1_FjrUD.js";const Q=o.forwardRef(({className:t,bsPrefix:s,as:n="div",...a},r)=>(s=p(s,"card-body"),e.jsx(n,{ref:r,className:y(t,s),...a})));Q.displayName="CardBody";const Z=o.forwardRef(({className:t,bsPrefix:s,as:n="div",...a},r)=>(s=p(s,"card-footer"),e.jsx(n,{ref:r,className:y(t,s),...a})));Z.displayName="CardFooter";const P=o.createContext(null);P.displayName="CardHeaderContext";const ee=o.forwardRef(({bsPrefix:t,className:s,as:n="div",...a},r)=>{const c=p(t,"card-header"),d=o.useMemo(()=>({cardHeaderBsPrefix:c}),[c]);return e.jsx(P.Provider,{value:d,children:e.jsx(n,{ref:r,...a,className:y(s,c)})})});ee.displayName="CardHeader";const se=o.forwardRef(({bsPrefix:t,className:s,variant:n,as:a="img",...r},c)=>{const d=p(t,"card-img");return e.jsx(a,{ref:c,className:y(n?`${d}-${n}`:d,s),...r})});se.displayName="CardImg";const te=o.forwardRef(({className:t,bsPrefix:s,as:n="div",...a},r)=>(s=p(s,"card-img-overlay"),e.jsx(n,{ref:r,className:y(t,s),...a})));te.displayName="CardImgOverlay";const ne=o.forwardRef(({className:t,bsPrefix:s,as:n="a",...a},r)=>(s=p(s,"card-link"),e.jsx(n,{ref:r,className:y(t,s),...a})));ne.displayName="CardLink";const De=J("h6"),ae=o.forwardRef(({className:t,bsPrefix:s,as:n=De,...a},r)=>(s=p(s,"card-subtitle"),e.jsx(n,{ref:r,className:y(t,s),...a})));ae.displayName="CardSubtitle";const re=o.forwardRef(({className:t,bsPrefix:s,as:n="p",...a},r)=>(s=p(s,"card-text"),e.jsx(n,{ref:r,className:y(t,s),...a})));re.displayName="CardText";const Me=J("h5"),oe=o.forwardRef(({className:t,bsPrefix:s,as:n=Me,...a},r)=>(s=p(s,"card-title"),e.jsx(n,{ref:r,className:y(t,s),...a})));oe.displayName="CardTitle";const ie=o.forwardRef(({bsPrefix:t,className:s,bg:n,text:a,border:r,body:c=!1,children:d,as:w="div",...f},g)=>{const j=p(t,"card");return e.jsx(w,{ref:g,...f,className:y(s,j,n&&`bg-${n}`,a&&`text-${a}`,r&&`border-${r}`),children:c?e.jsx(Q,{children:d}):d})});ie.displayName="Card";const E=Object.assign(ie,{Img:se,Title:oe,Subtitle:ae,Body:Q,Link:ne,Text:re,Header:ee,Footer:Z,ImgOverlay:te});class _{constructor(s){const{topId:n,id:a,answerTitle:r,answerLink:c}=s;this.chatBotAnswer={topId:n,id:a,answerTitle:r??"",answerLink:c??"",created:s.created,modified:s.modified}}chatBotAnswer}const He=()=>{const[t,s]=o.useState(null),[n,a]=o.useState(0),r=async w=>{s(w);let f=!1,g=null;if(w){const{assignedAnswers:j}=w;if(j&&j.length>0){const C=j[0];g=new _(C).chatBotAnswer,f=j.length>1,a(0)}}return{firstChatBotAnswer:g,hasMoreAnswers:f}},c=o.useCallback(async()=>t,[t]),d=o.useCallback(async()=>{const{assignedAnswers:w}=t,f=w.length,g=n+1;return n+1<f?(a(g),{nextChatBotAnswer:new _(w[g]).chatBotAnswer,hasMoreAnswers:g+1<f}):{nextChatBotAnswer:null,hasMoreAnswers:!1}},[t,n]);return[r,c,d]},Ke="rgba(255, 192, 203, 0.6)",Le="rgb(224, 207, 252)";function qe({children:t,eventKey:s,hasSubCategories:n,callback:a}){const{activeEventKey:r}=o.useContext(ve),c=ke(String(s??""),()=>a&&a(s)),d=r===s;return e.jsx("button",{type:"button",className:`accordion-button ${n?"":"hide-icon"}`,style:{backgroundColor:d?Ke:Le},onClick:c,children:t})}const Fe=({row:t})=>e.jsxs(E,{children:[e.jsx(E.Header,{children:e.jsx(qe,{eventKey:t.id,hasSubCategories:t.hasSubCategories,children:t.title})}),e.jsx(Y.Collapse,{eventKey:t.id,children:e.jsx(E.Body,{children:t.hasSubCategories&&e.jsx(le,{rows:t.categoryRows})})})]}),le=({rows:t})=>e.jsx(e.Fragment,{children:t.map(s=>e.jsx(Fe,{row:s},s.id))}),Oe=async(t,s)=>{console.log("onSelectCategory",{eventKey:t,e:s})},Ge=o.forwardRef(({topRows:t},s)=>{const{allCategoryRowsGlobal:n}=X(),a=o.useCallback(async r=>{const{id:c}=r;n.forEach(async d=>{d.categoryRows=[],d.id!==c&&d.parentId===c&&(await a(d),r.categoryRows.push(d))})},[n]);return o.useImperativeHandle(s,()=>({loadSubTree:r=>a(r)}),[a]),e.jsx(Y,{defaultActiveKey:"MTS",alwaysOpen:!0,onSelect:Oe,children:e.jsx(le,{rows:t})})}),Ve=({show:t,onHide:s})=>{let{tekst:n}=Be();const[a,r]=o.useState(n),[c,d,w]=He(),[f,g]=o.useState(null),[j,C]=o.useState(1),[de,D]=o.useState(!1),[l,S]=o.useState(null),[ce,v]=o.useState(!1),{loadAllCategoryRowsGlobal:M,getQuestion:ue,addHistory:H,addHistoryFilter:me,searchQuestions:xe}=Te(),{authUser:k,isDarkMode:he,allCategoryRowsGlobalLoaded:B,allCategoryRowsGlobal:K}=X(),[we]=o.useState(!0),[L,q]=o.useState(!0),[F,O]=o.useState([]),G=o.useRef(null),[fe,b]=o.useState([]);let $;(i=>{i[i.AUTO_SUGGEST=0]="AUTO_SUGGEST",i[i.QUESTION=1]="QUESTION",i[i.ANSWER=2]="ANSWER"})($||($={})),o.useEffect(()=>{(async()=>B||await M())()},[B,M]);const ge=async()=>{O([]);const i=performance.now();K.forEach(async h=>{h.parentId===null&&(h.categoryRows=[],await G?.current?.loadSubTree(h),O(x=>[...x,h]),console.log("ChatBotDlg onEntering setTopRows",[...F,h]))});const u=performance.now()-i;console.log(`Execution time: ${u} milliseconds`)},pe=o.useRef(null);if(!B)return e.jsx("div",{children:"Loading ..."});const ye=async(i,m)=>{const u=await d();if(u){console.log({questionCurr:u});const N={questionKey:new I(u).questionKey,filter:m,created:{time:new Date,nickName:k.nickName}};await me(N)}if(l){const N={type:2,isDisabled:!0,txt:l.answerTitle,link:l.answerLink};b(T=>[...T,N])}const h=await ue(i),{question:x}=h;if(!x)return;x.numOfRelatedFilters>0&&r(x.relatedFilters[0].filter);const be=await c(x);let{firstChatBotAnswer:Ae,hasMoreAnswers:Se}=be;if(x){const N={type:1,isDisabled:!0,txt:x.title,link:null};b(T=>[...T,N])}C(N=>N+1),q(!1),g(x),D(!0),v(Se),S(Ae)},je=async()=>{const i={type:2,isDisabled:!0,txt:l?l.answerTitle:"no answer title",link:l?l.answerLink:"no answer link",hasMoreAnswers:!0};b(u=>[...u,i]);const m={questionKey:new I(f).questionKey,assignedAnswerKey:{topId:l.topId,id:l.id},userAction:"Fixed",created:{nickName:k.nickName,time:new Date}};H(m),v(!1),S(l),D(!1)},Ne=async()=>{const i={type:2,isDisabled:!0,txt:l?l.answerTitle:"no answer",link:l?l.answerLink:"no link",hasMoreAnswers:!0};b(x=>[...x,i]);const m=await w(),{nextChatBotAnswer:u,hasMoreAnswers:h}=m;if(l){const x={questionKey:new I(f).questionKey,assignedAnswerKey:{topId:l.topId,id:l.id},userAction:u?"NotFixed":"NotClicked",created:{nickName:k.nickName,time:new Date}};H(x)}v(h),console.log("----->>>>",{nextChatBotAnswer:u}),S(u)},Ce=i=>{const{txt:m}=i;return e.jsx("div",{id:j.toString(),className:"d-flex flex-row mx-0 justify-content-start align-items-center",children:e.jsxs("div",{className:"d-flex flex-row mx-0 justify-content-start align-items-center",children:[e.jsx("img",{width:"22",height:"18",src:Ee,alt:"Question",className:"ms-1"}),e.jsx("div",{className:"p-1 bg-warning text-light flex-wrap text-wrap border rounded-1",children:m})]})})},U=i=>{console.log("--------------------------------------AnswerComponent",i);const{isDisabled:m,txt:u,link:h}=i;return e.jsx("div",{id:l?.id,className:`${he?"dark":"light"} mt-1 mx-1 border border-0 rounded-1`,children:e.jsxs("div",{className:"d-flex flex-row mx-0 justify-content-start align-items-center",children:[e.jsxs("div",{className:"d-flex flex-row mx-0 justify-content-start align-items-center",children:[e.jsx("img",{width:"22",height:"18",src:Ie,alt:"Answer",className:"ms-1"}),h?e.jsx("div",{className:"p-1 bg-info text-light flex-wrap text-wrap border rounded-1 ",children:e.jsx("a",{href:h,rel:"noopener noreferrer",target:"_blank",className:"text-light text-decoration-underline",children:u})}):e.jsx("div",{className:"p-1 bg-info text-light flex-wrap text-wrap border rounded-1",children:u})]}),!m&&l&&e.jsxs("div",{children:[e.jsx(R,{size:"sm",type:"button",onClick:je,disabled:!l,className:"align-middle ms-1 px-1  py-0",variant:"success",children:"Fixed"}),e.jsx(R,{size:"sm",type:"button",onClick:Ne,disabled:!l,className:"align-middle ms-1 border border-1 rounded-1 px-1 py-0",variant:"danger",children:"Not fixed"})]})]})})},z=i=>{const{isDisabled:m,txt:u}=i;return e.jsxs("div",{className:"dark",children:[e.jsx("label",{className:"text-warning",children:"Please enter the Question"}),e.jsx("div",{className:"text-start",children:e.jsxs("div",{className:"questions",children:[m&&e.jsx("div",{children:u}),!m&&e.jsx(Qe,{tekst:u,onSelectQuestion:ye,allCategoryRows:K,searchQuestions:xe})]})})]})};return console.log("=====================>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> rendering ChatBotDlg"),e.jsxs("div",{className:"pe-6 overflow-auto chat-bot-dlg",children:[e.jsx("style",{children:`
                .card-header {
                    padding: 0.0rem 0.03rem;
                    font-size: 0.8rem;
                }
                .card-header button  {
                    border: 0.3px solid silver;
                    border-radius: 3px;
                    text-align: left;
                }

                .card-body {
                    padding: 0.0rem 0.5rem;
                    font-size: 0.8rem;
                }

                .accordion-body {
                    padding: 0.3rem 0.3rem;
                    font-size: 0.6rem;
                }

                .accordion-button  {
                    padding: 0.1rem 0.3rem;
                    border: 0.3px solid silver;
                    border-radius: 3px;
                    text-align: left;
                }
                    
                ul {
                    list-style-type: none;
                }

                .accordion-button.hide-icon::after {
                    display: none;
                }
            }

            `}),e.jsxs(A,{show:t,onHide:s,placement:"end",scroll:!0,backdrop:!0,onEntering:ge,children:[" ",e.jsx(A.Header,{closeButton:!0,children:e.jsx(A.Title,{className:"fs-6",children:"I am your Buddy"})}),e.jsx(A.Body,{className:"p-0 border border-1 rounded-3",children:e.jsxs(Re,{id:"container",fluid:!0,className:"text-primary",children:[" ",e.jsx(V,{className:"m-0",children:e.jsx(W,{children:e.jsx(Ge,{topRows:F,ref:G})})}),e.jsx(V,{className:"m-0",children:e.jsxs(W,{className:"border border-0 border-primary mx-1 text-white p-0",children:[e.jsx("div",{className:"history",children:fe.map(i=>{switch(i.type){case 0:return e.jsx(z,{...i});case 1:return e.jsx(Ce,{...i});case 2:return e.jsx(U,{...i});default:return e.jsx("div",{children:"unknown"})}})},"history"),de&&e.jsx("div",{children:e.jsx(U,{type:2,isDisabled:!1,txt:l?l.answerTitle:"no answers",hasMoreAnswers:ce,link:l?l.answerLink:""})},"answer"),we&&!L&&e.jsx(R,{variant:"secondary",size:"sm",type:"button",onClick:()=>{C(j+1),q(!0)},className:"m-1 border border-1 rounded-1 py-0",children:"New Question"},"newQuestion"),L&&e.jsx("div",{className:"pb-35 questions",children:e.jsx(z,{type:0,isDisabled:!1,txt:a,link:null})}),e.jsx("div",{ref:pe,children:"dno dna"})]})})]})})]})]})};export{Ve as default};
//# sourceMappingURL=ChatBotDlg-64edl32v.js.map
